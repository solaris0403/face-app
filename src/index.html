<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="Pragma" content="no-cache">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

	<link rel="stylesheet" href="./css/index.css">
	<link rel="stylesheet" href="./css/jquery-weui.min.css">
	<link rel="stylesheet" href="./css/weui.min.css">
	<link type="text/css" rel="stylesheet" href="./hui/css/hui.css" />
	<title></title>
</head>

<body>
<div class="header">
	<div class="weui-search-bar" id="searchBar">
		<form class="weui-search-bar__form">
			<div class="weui-search-bar__box">
				<i class="weui-icon-search"></i>
				<input type="search" class="weui-search-bar__input" id="searchInput" placeholder="搜索" required="">
				<a href="javascript:" class="weui-icon-clear" id="searchClear"></a>
			</div>
			<label class="weui-search-bar__label" id="searchText">
				<i class="weui-icon-search"></i>
				<span>搜索</span>
			</label>
		</form>
		<a href="javascript:" class="weui-search-bar__cancel-btn" id="searchCancel">取消</a>
	</div>
	<div class="wrapper wrapper01" id="retr">
		<div class="scroller">
			<ul class="clearfix">
				<li><a href="javascript:void(0)">金馆长</a></li>
				<li><a href="javascript:void(0)">张学友</a></li>
				<li><a href="javascript:void(0)">教皇</a></li>
				<li><a href="javascript:void(0)">尔康</a></li>
				<li><a href="javascript:void(0)">兵库北</a></li>
				<li><a href="javascript:void(0)">doge</a></li>
				<li><a href="javascript:void(0)">大眼萌</a></li>
				<li><a href="javascript:void(0)">斯巴达</a></li>
				<li><a href="javascript:void(0)">单挑</a></li>
				<li><a href="javascript:void(0)">皮皮虾</a></li>
				<li><a href="javascript:void(0)">修仙</a></li>
				<li><a href="javascript:void(0)">黑恶势力</a></li>
				<li><a href="javascript:void(0)">魔性小人</a></li>
				<li><a href="javascript:void(0)">枪</a></li>
				<li><a href="javascript:void(0)">剑</a></li>
				<li><a href="javascript:void(0)">拉条</a></li>
				<li><a href="javascript:void(0)">钱</a></li>
				<li><a href="javascript:void(0)">烟</a></li>
				<li><a href="javascript:void(0)">证</a></li>
				<li><a href="javascript:void(0)">饮料</a></li>
				<li><a href="javascript:void(0)">其他道具</a></li>
			</ul>
		</div>
	</div>
</div>
<div class="space"></div>
<!-- <div class="content">
	<div id="layui-face-container">
	</div>
</div> -->
<div class="hui-wrap">
    <div id="refreshContainer" class="hui-refresh">
        <div class="hui-refresh-icon"></div>
        <div class="hui-refresh-content hui-list">
            <ul id="list"></ul>
        </div>
    </div>
</div>
<script src="./js/jquery.min.js"></script>
<!-- <script type="text/javascript" src="/zx_local_res/jssdk/cordova.js"></script>
<script type="text/javascript" src="/zx_local_res/jssdk/zx.js"></script> -->
<script type="text/javascript" src="./js/flexible.js"></script>
<script type="text/javascript" src="./js/iscroll.js"></script>
<script type="text/javascript" src="./js/navbarscroll.js"></script>
<script type="text/javascript" src="./js/jquery-weui.min.js"></script>
<script type="text/javascript" src="./hui/js/hui.js"></script>
<script src="./hui/js/hui-refresh-load-more.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
		$(document).ready(function() {
			var height = $(".header").outerHeight(true);
			$(".space").height(height);
		});

		// var keyword;
		// var myPage;
		// var option = function() {
		// 	var flow = layui.flow;
		// 	flow.load({
		// 		elem: '#layui-face-container', //流加载容器
		// 		isLazyimg: true,
		// 		done: function(page, next) { //加载下一页
		// 			var url = "https://www.doutula.com/api/search?mime=0&keyword=" + keyword + "&page=" + page;
		// 			console.log(url);
		// 			// zx.requestLocalApi(function (result) {
		// 			// 	var status = result["status"];//数据状态 1:正常 0:异常
		// 			// 	var data = result["data"];
		// 			// 	var list = data["list"];
		// 			// 	var more = data["more"];//表示下一页是否还有数据，0 就别再请求了。
		// 			//
		// 			// 	var lis = [];
		// 			// 	layui.each(list, function(index, item){
		// 			// 		var out_id = list[index]["out_id"];
		// 			// 		var image_url = list[index]["image_url"];
		// 			// 		lis.push('<li><img lay-src=' + image_url + ' onclick="javascript:fun(this.src);"' + '></li>')
		// 			// 	});
		// 			// 	next(lis.join(''), more == 1); //假设总页数为 6
		// 			// }, url, 0, null);
		// 			//模拟插入
		// 			setTimeout(function() {
		// 				var lis = [];
		// 				for (var i = 0; i < 6; i++) {
		// 					var src = "http://s17.mogucdn.com/p2/161011/upload_279h87jbc9l0hkl54djjjh42dc7i1_800x480.jpg?v=' + ((page - 1) * 6 + i + 1) + '";
		// 					lis.push('<li><img lay-src=' + src + ' onclick="javascript:fun(this.src);"' + '></li>')
		// 				}
		// 				next(lis.join(''), page < 50); //假设总页数为 6
		// 			}, 0);
		// 		}
		// 	});
		// 	//按屏加载图片
		// 	flow.lazyimg({
		// 		elem: '#layui-face-container img'
		// 	});
		// };

		var div = "<div id=\"layui-face-container\"></div>";
		var index = -1;
		function navClick(obj) {
			if (obj.index() != index) {
				keyword = obj.text();
				$("#list").empty();
				// layui.use('flow', option);
				index = obj.index();
				hui.refresh('#refreshContainer', refresh);
			}
		};

		function fun(url) {
			url = "detail.html?url=" + url;
			window.location.href = encodeURI(url);
		}

		$('.wrapper').navbarscroll({
				endClickScroll: function(obj) {
					navClick(obj);
				}
		});
		var page = 1;
		// hui.refresh('#refreshContainer', refresh);
		hui.loadMore(getMore);
		//加载更多
		function getMore(){
			console.log("getMore" + page);
		    hui.get(
		        'http://hoa.hcoder.net/index.php?user=hcoder&pwd=hcoder&m=list1&page='+page,
		        function(res){
		            //判断加载完毕
		            if(res == 'null'){
		                hui.endLoadMore(true, '已经到头了...');
		                return false;
		            }
		            var data = res.split('--hcSplitor--');
		            for(var i = 0; i < data.length; i++){
		                var li = document.createElement('li');
		                li.innerHTML = '<div class="hui-list-text">'+data[i]+'</div>';
		                hui(li).appendTo('#list');
		            }
		            page++;
		            hui.endLoadMore();
		        }
		    );
		}

		//下拉刷新
		function refresh(){
				page = 1;
				console.log("refresh" + page);
		    hui.loading('加载中...');
		    hui.get(
		        'http://hoa.hcoder.net/index.php?user=hcoder&pwd=hcoder&m=list1&page=1',
		        function(res){
		            hui.closeLoading();
		            var data = res.split('--hcSplitor--');
		            var html = '';
		            for(var i = 0; i < data.length; i++){
		                html += '<a href="javascript:hui.toast(\'hi.....\');"><div class="hui-list-text">'+data[i]+'</div></a>';
		            }
		            hui('#list').html(html);
		            //结束刷新
		            hui.endRefresh();
		            //重置加载更多状态
		            hui.resetLoadMore();
								page++;
		        },
		        function(){
		            hui.closeLoading();
		            hui.upToast('连接服务器失败！');
		            hui.endRefresh();
		        }
		    );
		}

		// var app = {
		// // Application Constructor
		// 	initialize: function() {
		// 			this.bindEvents();
		// 	},
		//
		// 	// Bind Event Listeners
		// 	//
		// 	// Bind any events that are required on startup. Common events are:
		// 	// 'load', 'deviceready', 'offline', and 'online'.
		// 	bindEvents: function() {
		// 			document.addEventListener('deviceready', this.onDeviceReady, false);
		// 	},
		//
		// 	// deviceready Event Handler
		// 	//
		// 	// The scope of 'this' is the event. In order to call the 'receivedEvent'
		// 	// function, we must explicitly call 'app.receivedEvent(...);'
		// 	onDeviceReady: function() {
		// 			// alert("onDeviceReady ua="+navigator.userAgent);
		// 			$('.wrapper').navbarscroll({
		// 					endClickScroll: function(obj) {
		// 						navClick(obj);
		// 					}
		// 			});
		// 		}
		// 	};
		// app.initialize();
	</script>
</body>

</html>
